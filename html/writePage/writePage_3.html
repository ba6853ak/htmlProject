<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>게시물 작성</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" href="../../Css/WritePage/writePage_1.css" />
  <link rel="stylesheet" href="../../Css/Public/Public.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Pretendard", sans-serif;
      background: linear-gradient(135deg, #ffffff, #f5f5f5);
      margin: 0;
      padding: 0;
      scroll-behavior: smooth;
    }

    .date-range {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quick-select {
      margin-top: 10px;
    }

    .quick-select label {
      margin-right: 10px;
    }

    /* Updated Survey Styles */
    .survey-container {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background-color: #ffffff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .survey-container h3 {
      margin-top: 0;
      color: #333;
      font-size: 1.2em;
      margin-bottom: 20px;
    }

    .survey-question {
      margin-bottom: 20px;
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 6px;
    }

    .survey-question label {
      display: block;
      margin-bottom: 10px;
      font-weight: 500;
      color: #444;
    }

    .survey-question input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .survey-option {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .survey-option input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .survey-option button {
      margin-left: 10px;
      padding: 8px 12px;
      font-size: 14px;
      background-color: #f44336;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .survey-option button:hover {
      background-color: #d32f2f;
    }

    .add-question-button,
    #addOptionButton {
      margin-top: 15px;
      padding: 10px 15px;
      font-size: 14px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .add-question-button:hover,
    #addOptionButton:hover {
      background-color: #45a049;
    }

    #addOptionButton {
      background-color: #2196f3;
    }

    #addOptionButton:hover {
      background-color: #1976d2;
    }
  </style>

  <script src="../../lib/JQuery/JQuery_3.7.1.js"></script>
  <script>
    $(document).ready(function () {
      $("#header").load("../Public/header.html");
      $("#footer").load("../Public/footer.html");
    });
  </script>
  <header id="header"></header>


</head>

<body>
  <div class="container">
    <h2>새로운 생각 쓰기</h2>
    <form id="postForm">
      <div class="form-group">
        <label for="title">제목</label>
        <input type="text" id="title" name="title" placeholder="제목을 입력하세요" maxlength="200" required />
        <div class="char-count">
          글자 수: <span id="titleCharCount">0</span> / 200
        </div>
      </div>

      <div class="form-group">
        <label for="content">내용</label>
        <textarea id="content" name="content" placeholder="내용을 입력하세요..." required></textarea>
      </div>

      <div class="form-group">
        <label for="participationPeriod">참여기간</label>
        <div class="date-range">
          <input type="date" id="startDate" name="startDate" required />
          <span>~</span>
          <input type="date" id="endDate" name="endDate" required />
        </div>
        <div class="quick-select">
          <label><input type="radio" name="quickSelect" value="2weeks" />
            2주일</label>
          <label><input type="radio" name="quickSelect" value="1month" />
            1개월</label>
          <label><input type="radio" name="quickSelect" value="2months" />
            2개월</label>
        </div>
      </div>

      <div class="form-group">
        <label for="file">파일 첨부</label>
        <div class="file-input-wrapper">
          <label for="file" class="file-input-button">파일 선택</label>
          <input type="file" id="file" name="file" />
          <span class="file-input-name">선택된 파일 없음</span>
        </div>
      </div>

      <!-- 설문 섹션 -->
      <div class="survey-container">
        <h3>설문 추가</h3>
        <div id="surveySection">
          <div class="survey-question">
            <label for="surveyQuestion1">질문 1</label>
            <input type="text" id="surveyQuestion1" name="surveyQuestions[]" placeholder="설문 질문을 입력하세요"
              maxlength="200" />
          </div>
          <div class="survey-option">
            <input type="text" name="surveyOptions1[]" placeholder="옵션 1을 입력하세요" />
            <button type="button" class="remove-option">삭제</button>
          </div>
          <div class="survey-option">
            <input type="text" name="surveyOptions1[]" placeholder="옵션 2를 입력하세요" />
            <button type="button" class="remove-option">삭제</button>
          </div>
        </div>
        <button type="button" id="addOptionButton">옵션 추가</button>
        <button type="button" class="add-question-button" id="addQuestionButton">
          질문 추가
        </button>
      </div>

      <div class="form-group">
        <div class="buttons">
          <button type="submit" class="button button-primary">시작하기</button>&nbsp;&nbsp;
          <button type="button" id="cancelButton" class="button button-secondary">
            취소
          </button>
        </div>
      </div>
    </form>
  </div>

  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title">확인</h3>
      <p class="modal-message">
        작성 중인 내용이 모두 삭제됩니다. <br />정말 취소하시겠습니까?
      </p>
      <button id="confirmCancel" class="modal-button modal-button-secondary">
        아니오
      </button>
      <button id="confirmOk" class="modal-button modal-button-primary">
        예
      </button>
    </div>
  </div>

  <div id="successModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title">성공</h3>
      <p class="modal-message">게시물이 성공적으로 작성되었습니다!</p>
      <button id="successOk" class="modal-button modal-button-primary">
        확인
      </button>
    </div>
  </div>

  <header id="footer"></header>


  <script>
    const titleInput = document.getElementById("title");
    const titleCharCountSpan = document.getElementById("titleCharCount");
    const cancelButton = document.getElementById("cancelButton");
    const fileInput = document.getElementById("file");
    const fileInputName = document.querySelector(".file-input-name");
    const confirmModal = document.getElementById("confirmModal");
    const successModal = document.getElementById("successModal");
    const confirmCancel = document.getElementById("confirmCancel");
    const confirmOk = document.getElementById("confirmOk");
    const successOk = document.getElementById("successOk");
    const postForm = document.getElementById("postForm");
    const startDateInput = document.getElementById("startDate");
    const endDateInput = document.getElementById("endDate");
    const quickSelectInputs = document.querySelectorAll(
      'input[name="quickSelect"]'
    );

    // 글자 수 카운터
    titleInput.addEventListener("input", updateTitleCharCount);

    function updateTitleCharCount() {
      const charCount = titleInput.value.length;
      titleCharCountSpan.textContent = charCount;
    }

    // 모달 표시 함수
    function showModal(modal) {
      modal.style.display = "block";
    }

    // 모달 숨기기 함수
    function hideModal(modal) {
      modal.style.display = "none";
    }

    // 폼 리셋 함수
    function resetForm() {
      postForm.reset();
      titleCharCountSpan.textContent = "0";
      fileInputName.textContent = "선택된 파일 없음";
      startDateInput.value = new Date().toISOString().split("T")[0];
      endDateInput.value = "";
      quickSelectInputs.forEach((input) => (input.checked = false));
    }

    // 오늘 날짜 설정
    const today = new Date();
    const todayString = today.toISOString().split("T")[0];
    startDateInput.min = todayString;
    endDateInput.min = todayString;
    startDateInput.value = todayString;

    // 날짜 유효성 검사 및 자동 조정
    function validateAndAdjustDates() {
      const startDate = new Date(startDateInput.value);
      const endDate = new Date(endDateInput.value);

      if (endDate < startDate) {
        endDateInput.value = startDateInput.value;
      }
    }

    startDateInput.addEventListener("change", function () {
      endDateInput.min = this.value;
      validateAndAdjustDates();
    });

    endDateInput.addEventListener("change", validateAndAdjustDates);

    quickSelectInputs.forEach((input) => {
      input.addEventListener("change", function () {
        const startDate = new Date(startDateInput.value);
        let endDate = new Date(startDate);
        switch (this.value) {
          case "2weeks":
            endDate.setDate(startDate.getDate() + 13); // 14일째 되는 날
            break;
          case "1month":
            endDate.setMonth(startDate.getMonth() + 1);
            endDate.setDate(startDate.getDate() - 1); // 1달 후 하루 전
            break;
          case "2months":
            endDate.setMonth(startDate.getMonth() + 2);
            endDate.setDate(startDate.getDate() - 1); // 2달 후 하루 전
            break;
        }

        startDateInput.value = startDate.toISOString().split("T")[0];
        endDateInput.value = endDate.toISOString().split("T")[0];
      });
    });

    postForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      console.log("폼 데이터:", Object.fromEntries(formData));
      showModal(successModal);
    });

    cancelButton.addEventListener("click", function () {
      showModal(confirmModal);
    });

    confirmCancel.addEventListener("click", function () {
      hideModal(confirmModal);
    });

    confirmOk.addEventListener("click", function () {
      resetForm();
      hideModal(confirmModal);
      window.location.href = "newThinkWrite.html";
    });

    successOk.addEventListener("click", function () {
      resetForm();
      hideModal(successModal);
    });

    fileInput.addEventListener("change", function () {
      if (this.files && this.files[0]) {
        fileInputName.textContent = this.files[0].name;
      } else {
        fileInputName.textContent = "선택된 파일 없음";
      }
    });

    // 설문 기능
    let questionCount = 1;
    const surveySection = document.getElementById("surveySection");
    const addQuestionButton = document.getElementById("addQuestionButton");
    const addOptionButton = document.getElementById("addOptionButton");

    // 옵션 추가 기능
    addOptionButton.addEventListener("click", function () {
      const optionCount =
        surveySection.querySelectorAll(".survey-option").length + 1;
      const newOption = document.createElement("div");
      newOption.classList.add("survey-option");
      newOption.innerHTML = `
        <input type="text" name="surveyOptions${questionCount}[]" placeholder="옵션 ${optionCount}을 입력하세요">
        <button type="button" class="remove-option">삭제</button>
      `;
      surveySection.appendChild(newOption);

      // 삭제 버튼 기능 추가
      newOption
        .querySelector(".remove-option")
        .addEventListener("click", function () {
          surveySection.removeChild(newOption);
        });
    });

    // 질문 추가 기능
    addQuestionButton.addEventListener("click", function () {
      questionCount++;
      const newQuestion = document.createElement("div");
      newQuestion.classList.add("survey-question");
      newQuestion.innerHTML = `
        <label for="surveyQuestion${questionCount}">질문 ${questionCount}</label>
        <input type="text" id="surveyQuestion${questionCount}" name="surveyQuestions[]" placeholder="설문 질문을 입력하세요" maxlength="200">
      `;

      const newOption1 = document.createElement("div");
      newOption1.classList.add("survey-option");
      newOption1.innerHTML = `
        <input type="text" name="surveyOptions${questionCount}[]" placeholder="옵션 1을 입력하세요">
        <button type="button" class="remove-option">삭제</button>
      `;

      const newOption2 = document.createElement("div");
      newOption2.classList.add("survey-option");
      newOption2.innerHTML = `
        <input type="text" name="surveyOptions${questionCount}[]" placeholder="옵션 2을 입력하세요">
        <button type="button" class="remove-option">삭제</button>
      `;

      surveySection.appendChild(newQuestion);
      surveySection.appendChild(newOption1);
      surveySection.appendChild(newOption2);

      // 각 옵션의 삭제 버튼에 기능 추가
      newOption1
        .querySelector(".remove-option")
        .addEventListener("click", function () {
          surveySection.removeChild(newOption1);
        });
      newOption2
        .querySelector(".remove-option")
        .addEventListener("click", function () {
          surveySection.removeChild(newOption2);
        });
    });
  </script>
</body>

</html>